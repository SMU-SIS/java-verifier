<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
            "http://www.w3.org/TR/html4/strict.dtd">
<html>	
	<title>JSP Verifier</title>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js" type="text/javascript"></script>
		<script src="js/prettyprint.js" type="text/javascript"></script>		
		<script type="text/javascript">
		
		// adapted from https://github.com/tleese22/google-app-engine-jappstart/blob/master/src/main/webapp/js/script.js
		function stringifyForm($form) {
    			var values = {};
    
    			$form.find('input[type != submit],textarea').each(function() {
        			values[this.name] = $(this).val();
    			});
    		
    			return JSON.stringify(values);

		}
		
		$(function() {
			$('input#verifier-submit').click(
				function(e) {
					$.ajax({
						type: 'POST',
						url: 'cgi-bin/verifier.py',
						data: {jsonrequest: stringifyForm($('form#java-verifier'))},
						success: function(data, textStatus, jqXHR) {
							$('div#response').empty().append(prettyPrint(data));
						}
					});
					
					e.preventDefault(); // don't actually submit the form
				}
			);
		});
		
		</script>
	</head>
	<body>
	
		<form id="java-verifier">
			<h2>JSP verifier</h2>
			<h3>JSP File</h3>
			<textarea name="solution" rows="10" cols="80">
<%@ page import="java.util.*, java.text.*" %>
<HTML>
<HEAD>
<TITLE>Hello Pineapples</TITLE>
</HEAD>
<BODY>
	<H1>Hello World</H1>
	<TABLE>
		<TR>
			<TD>
				<P>
					This is an <B>embedded</B> table
				</P>
			</TD>
		</TR>
		<TR>
			<TD>
				The request parameter 'fruit' has a value of <%= request.getParameter("fruit") %>
			</TD>
		</TR>
	</TABLE>
	Today is: <%= new SimpleDateFormat("dd/MM/yyyy").format(new Date()) %>
</BODY>
</HTML>
			</textarea>	
<!--			<h3>Request Parameters</h3>		
			<textarea name="parameters" rows="10" cols="80">
// setRequestParameter("fruit", "guava");
			</textarea> -->
			<h3>Assertions</h3>
			<textarea name="tests" rows="10" cols="80">
String expectedDate = new SimpleDateFormat("dd/MM/yyyy").format(new Date());
page().shouldHaveTitle("Hello Pineapples");
page().shouldContain("Today is: "+expectedDate);
onRequest("fruit", "guava").page().shouldContain("The request parameter 'fruit' has a value of guava");
page().shouldContainElement("//TABLE/TR/TD/P/B");
element("//TABLE/TR/TD/P/B").shouldContain("embedded");
			</textarea>
		        <br/>	
			<input type="submit" id="verifier-submit">Submit</input>
		</form>
		
		<div id="response" style="width: 800px;"></div>
	
	</body>
</html>
